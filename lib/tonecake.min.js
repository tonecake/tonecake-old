function organFreqSet(e){"keep"!=e.soprano&&(soprano.frequency.value=e.soprano),"keep"!=e.alto&&(alto.frequency.value=e.alto),"keep"!=e.tenor&&(tenor.frequency.value=e.tenor),"keep"!=e.bass&&(bass.frequency.value=e.bass)}function organSopranoSet(e){if(!e)var e=0;organFreqSet({soprano:e,alto:"keep",tenor:"keep",bass:"keep"})}function organAltoSet(e){if(!e)var e=0;organFreqSet({soprano:"keep",alto:e,tenor:"keep",bass:"keep"})}function organTenorSet(e){if(!e)var e=0;organFreqSet({soprano:"keep",alto:"keep",tenor:e,bass:"keep"})}function organBassSet(e){if(!e)var e=0;organFreqSet({soprano:"keep",alto:"keep",tenor:"keep",bass:e})}function organReset(){organFreqSet({soprano:0,alto:0,tenor:0,bass:0})}var info=new Object,tonecake={create:function(e){info.language="default",info.currentTonart=e.tone+"-"+e.tonality;Cake.create(e);info.currentHarmony=Harmony.create({tone:e.tone,tonality:e.tonality}),info.created=!0,tonecake.event(),tonecake.pedal()},event:function(){for(var e=document.querySelectorAll(".hexagon"),n=["hex0","hex1","hex2","hex3","hex4","hex5","hex6"],a=function(){this.className+=" onEvent",console.log(n.indexOf(this.id)+"-started")},t=function(){this.className="hexagon",console.log(n.indexOf(this.id)+"-ended")},o=0;o<e.length;o++)e[o].addEventListener("mousedown",a),e[o].addEventListener("mouseup",t),e[o].addEventListener("touchstart",a),e[o].addEventListener("touchend",t)},pedal:function(){function e(){info.onTerzImBass=!0,info.onQuinteImBass=!0,info.onSeptimeImBass=!0,document.getElementById("btn3").className="",document.getElementById("btn5").className="",document.getElementById("btn7").className=""}document.addEventListener("keydown",function(n){switch(window.event?n.keyCode:n.which){case 16:info.onSustain=!0,document.getElementById("btnSustain").className+="on";break;case 17:info.onSeptime=!0,document.getElementById("btnSeptime").className+="on";break;case 90:(info.onQuinteImBass||info.onSeptimeImBass)&&e(),info.onTerzImBass=!0,document.getElementById("btn3").className+="on";break;case 88:(info.onTerzImBass||info.onSeptimeImBass)&&e(),info.onQuinteImBass=!0,document.getElementById("btn5").className+="on";break;case 67:(info.onTerzImBass||info.onQuinteImBass)&&e(),info.onSeptimeImBass=!0,document.getElementById("btn7").className+="on"}}),document.addEventListener("keyup",function(e){switch(window.event?e.keyCode:e.which){case 16:info.onSustain=!1,info.nowplay=!1,document.getElementById("btnSustain").className="",organReset();break;case 17:info.onSeptime=!1,document.getElementById("btnSeptime").className="";break;case 90:info.onTerzImBass=!1,document.getElementById("btn3").className="";break;case 88:info.onQuinteImBass=!1,document.getElementById("btn5").className="";break;case 67:info.onSeptimeImBass=!1,document.getElementById("btn7").className=""}})},play:function(e){var n=Harmony.positioning(e),a=frequency.find(n[0].tone,n[0].octave),t=frequency.find(n[1].tone,n[1].octave),o=frequency.find(n[2].tone,n[2].octave),r=frequency.find(n[3].tone,n[3].octave);organFreqSet({soprano:a,alto:t,tenor:o,bass:r}),info.nowplay=!0,info.currentTonart=e},stop:function(){info.onSustain===!0||(organFreqSet({soprano:0,alto:0,tenor:0,bass:0}),info.nowplay=!1)}},Cake={create:function(e){function n(){a(),t(),o()}function a(){if(info.created){var n=document.getElementById("cake-wrapper");n.parentNode.removeChild(n)}r.wrapper=document.createElement("div"),r.wrapper.className="cake-wrapper",r.wrapper.id="cake-wrapper",r.wrapper.style.position="absolute",r.wrapper.style.display="block",r.wrapper.style.width=5*e.hexagonWidth+4*e.hexagonGutter+"px",r.wrapper.style.height=5*e.hexagonHeight+4*e.hexagonGutter+"px",r.wrapper.style.top="50%",r.wrapper.style.left="50%",r.wrapper.style.marginLeft="-"+(5*e.hexagonWidth+4*e.hexagonGutter)/2+"px",r.wrapper.style.marginTop="-"+(5*e.hexagonHeight+4*e.hexagonGutter)/2+"px",r.wrapper.style.padding=0,document.body.appendChild(r.wrapper)}function t(){r.cake=document.createElement("div"),r.cake.className="cake",r.cake.style.position="relative",r.cake.style.display="block",r.cake.style.width=e.hexagonWidth+"px",r.cake.style.height=e.hexagonHeight+"px",r.cake.style.top="50%",r.cake.style.margin="0 auto",r.cake.style.marginTop="-"+e.hexagonHeight/2+"px",r.wrapper.appendChild(r.cake)}function o(){var n=Harmony.create({tone:i,tonality:s}),a=null;for(a=0;r.hexagons.length>a;a+=1){r.hexagons[a].elem=document.createElement("div"),r.hexagons[a].elem.id=r.hexagons[a].id,r.hexagons[a].elem.className="hexagon",r.hexagons[a].elem.style.position="absolute",r.hexagons[a].elem.style.top=r.hexagons[a].top+"px",r.hexagons[a].elem.style.left=r.hexagons[a].left+"px",r.hexagons[a].elem.style.display="block",r.hexagons[a].elem.style.width=e.hexagonWidth+"px",r.hexagons[a].elem.style.height=e.hexagonHeight+"px",r.cake.appendChild(r.hexagons[a].elem);var t=document.createElement("div");t.style.position="absolute",t.style.color="#"+e.fontColor,t.style.textAlign="center",t.style.lineHeight=1.25,r.hexagons[a].elem.appendChild(t);var o=document.createElement("div");o.style.fontSize="2em",o.style.cursor="default",o.innerHTML=n.harmony[a].nameShort,t.appendChild(o);var m=document.createElement("div");m.style.fontSize="1em",m.style.cursor="default",m.innerHTML=n.harmony[a].tonart,t.appendChild(m),t.style.top="50%",t.style.left="50%",t.style.marginTop="-"+t.offsetHeight/2+"px",t.style.marginLeft="-"+t.offsetWidth/2+"px"}}var r={wrapper:null,cake:null,hexagons:[{elem:null,id:"hex0",top:0,left:0},{elem:null,id:"hex1",top:-1*(e.hexagonHeight+e.hexagonGutter),left:0},{elem:null,id:"hex2",top:-1*(e.hexagonHeight/2+e.hexagonGutter/2),left:e.hexagonWidth*e.hexagonRatio+e.hexagonGutter},{elem:null,id:"hex3",top:e.hexagonHeight/2+e.hexagonGutter/2,left:e.hexagonWidth*e.hexagonRatio+e.hexagonGutter},{elem:null,id:"hex4",top:e.hexagonHeight+e.hexagonGutter,left:0},{elem:null,id:"hex5",top:e.hexagonHeight/2+e.hexagonGutter/2,left:-1*(e.hexagonWidth*e.hexagonRatio+e.hexagonGutter)},{elem:null,id:"hex6",top:-1*(e.hexagonHeight/2+e.hexagonGutter/2),left:-1*(e.hexagonWidth*e.hexagonRatio+e.hexagonGutter)}]},i=e.tone,s=e.tonality;n()},response:function(){},animate:function(){}},Organ={config:{freq:{soprano:0,alto:0,tenor:0,bass:0},gain:{defaultVolume:.1}},initialize:function(){var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext;return e?new e:!1},create:function(){var e=Organ.initialize();gainNode1=e.createGain(),gainNode2=e.createGain(),gainNode3=e.createGain(),gainNode4=e.createGain(),soprano=e.createOscillator(),alto=e.createOscillator(),tenor=e.createOscillator(),bass=e.createOscillator(),soprano.connect(gainNode1),alto.connect(gainNode2),tenor.connect(gainNode3),bass.connect(gainNode4),gainNode1.connect(e.destination),gainNode2.connect(e.destination),gainNode3.connect(e.destination),gainNode4.connect(e.destination),gainNode1.gain.value=Organ.config.gain.defaultVolume,gainNode2.gain.value=Organ.config.gain.defaultVolume,gainNode3.gain.value=Organ.config.gain.defaultVolume,gainNode4.gain.value=Organ.config.gain.defaultVolume,organFreqSet({soprano:Organ.config.freq.soprano,alto:Organ.config.freq.alto,tenor:Organ.config.freq.tenor,bass:Organ.config.freq.bass})}};Organ.create();var time=Organ.initialize.currentTime,gainNode1,gainNode2,gainNode3,gainNode4,soprano,alto,tenor,bass;soprano.start(time),alto.start(time),tenor.start(time),bass.start(time);var frequency={find:function(e,n){if(!e||!n)return console.log("Error : Invalid argument / example) frequency.find(tone, octave)"),0;n>8&&(n=8,console.log("Error : Invaild value of argumenet (octave) / octave value rage : 0 ~ 8."));var a=null;for(a=0;frequency[n].length>a;a+=1)if(frequency[n][a].name===e)return frequency[n][a].freq},0:[{name:"c",freq:16.425625},{name:"cis",freq:17.4025},{name:"des",freq:17.4025},{name:"d",freq:295/16},{name:"dis",freq:19.53375},{name:"es",freq:19.53375},{name:"e",freq:20.695625},{name:"f",freq:21.92625},{name:"fis",freq:23.23},{name:"ges",freq:23.23},{name:"g",freq:24.61125},{name:"gis",freq:26.074375},{name:"as",freq:26.074375},{name:"a",freq:27.625},{name:"b",freq:29.2675},{name:"h",freq:31.008125}],1:[{name:"c",freq:32.85125},{name:"cis",freq:34.805},{name:"des",freq:34.805},{name:"d",freq:295/8},{name:"dis",freq:39.0675},{name:"es",freq:39.0675},{name:"e",freq:41.39125},{name:"f",freq:43.8525},{name:"fis",freq:46.46},{name:"ges",freq:46.46},{name:"g",freq:49.2225},{name:"gis",freq:52.14875},{name:"as",freq:52.14875},{name:"a",freq:55.25},{name:"b",freq:58.535},{name:"h",freq:62.01625}],2:[{name:"c",freq:65.7025},{name:"cis",freq:69.61},{name:"des",freq:69.61},{name:"d",freq:73.75},{name:"dis",freq:78.135},{name:"es",freq:78.135},{name:"e",freq:82.7825},{name:"f",freq:87.705},{name:"fis",freq:92.92},{name:"ges",freq:92.92},{name:"g",freq:98.445},{name:"gis",freq:104.2975},{name:"as",freq:104.2975},{name:"a",freq:110.5},{name:"b",freq:117.07},{name:"h",freq:124.0325}],3:[{name:"c",freq:131.405},{name:"cis",freq:139.22},{name:"des",freq:139.22},{name:"d",freq:147.5},{name:"dis",freq:156.27},{name:"es",freq:156.27},{name:"e",freq:165.565},{name:"f",freq:175.41},{name:"fis",freq:185.84},{name:"ges",freq:185.84},{name:"g",freq:196.89},{name:"gis",freq:208.595},{name:"as",freq:208.595},{name:"a",freq:221},{name:"b",freq:234.14},{name:"h",freq:248.065}],4:[{name:"c",freq:262.81},{name:"cis",freq:278.44},{name:"des",freq:278.44},{name:"d",freq:295},{name:"dis",freq:312.54},{name:"es",freq:312.54},{name:"e",freq:331.13},{name:"f",freq:350.82},{name:"fis",freq:371.68},{name:"ges",freq:371.68},{name:"g",freq:393.78},{name:"gis",freq:417.19},{name:"as",freq:417.19},{name:"a",freq:442},{name:"b",freq:468.28},{name:"h",freq:496.13}],5:[{name:"c",freq:525.62},{name:"cis",freq:556.88},{name:"des",freq:556.88},{name:"d",freq:590},{name:"dis",freq:625.08},{name:"es",freq:625.08},{name:"e",freq:662.26},{name:"f",freq:701.64},{name:"fis",freq:743.36},{name:"ges",freq:743.36},{name:"g",freq:787.56},{name:"gis",freq:834.38},{name:"as",freq:834.38},{name:"a",freq:884},{name:"b",freq:936.56},{name:"h",freq:992.26}],6:[{name:"c",freq:1051.24},{name:"cis",freq:1113.76},{name:"des",freq:1113.76},{name:"d",freq:1180},{name:"dis",freq:1250.16},{name:"es",freq:1250.16},{name:"e",freq:1324.52},{name:"f",freq:1403.28},{name:"fis",freq:1486.72},{name:"ges",freq:1486.72},{name:"g",freq:1575.12},{name:"gis",freq:1668.76},{name:"as",freq:1668.76},{name:"a",freq:1768},{name:"b",freq:1873.12},{name:"h",freq:1984.52}],7:[{name:"c",freq:2102.48},{name:"cis",freq:2227.52},{name:"des",freq:2227.52},{name:"d",freq:2360},{name:"dis",freq:2500.32},{name:"es",freq:2500.32},{name:"e",freq:2649.04},{name:"f",freq:2806.56},{name:"fis",freq:2973.44},{name:"ges",freq:2973.44},{name:"g",freq:3150.24},{name:"gis",freq:3337.52},{name:"as",freq:3337.52},{name:"a",freq:3536},{name:"b",freq:3746.24},{name:"h",freq:3969.04}],8:[{name:"c",freq:4204.96},{name:"cis",freq:4455.04},{name:"des",freq:4455.04},{name:"d",freq:4720},{name:"dis",freq:5000.64},{name:"es",freq:5000.64},{name:"e",freq:5298.08},{name:"f",freq:5613.12},{name:"fis",freq:5946.88},{name:"ges",freq:5946.88},{name:"g",freq:6300.48},{name:"gis",freq:6675.04},{name:"as",freq:6675.04},{name:"a",freq:7072},{name:"b",freq:7492.48},{name:"h",freq:7938.08}]},Harmony={create:function(e){function n(e,n){var a,t={tonart:e+"-"+n,harmony:[]};a="dur"===n?Harmony.rules.harmonyset.dur:Harmony.rules.harmonyset.moll;for(var o=0;o<a.length;o++){{var r;a[o].name}r="dur"===a[o].septime?"dur":"default";var i={name:a[o].name,nameShort:a[o].nameShort,nameTone:Harmony.functions.getToneByInterval(e,a[o].interval),tonart:Harmony.functions.getToneByInterval(e,a[o].interval)+"-"+a[o].tonality,akkord:Harmony.functions.getKlang(Harmony.functions.getToneByInterval(e,a[o].interval),a[o].tonality,r),descendant:[]};t.harmony.push(i)}return t}return e?n(e.tone,e.tonality):(console.log("Error : Invalid argument / example : Harmony.create({tone:_____,tonality:_____})"),!1)},positioning:function(){var e,n,a,t,o,r,i,s,m,l,f,d,c=new Array;return e={name:"soprano",tone:n,octave:a},t={name:"alto",tone:o,octave:r},i={name:"tenor",tone:s,octave:m},l={name:"bass",tone:f,octave:d},c.push(e,t,i,l),info.currentPosition=c,c},functions:{getKlang:function(e,n,a){var t;t="moll"===n?Harmony.rules.dreiklang.moll:"ver"===n?Harmony.rules.dreiklang.ver:"ueber"===n?Harmony.rules.dreiklang.ueber:Harmony.rules.dreiklang.dur;var o=Harmony.functions.getKeyindexByTone(e),r=Harmony.functions.adjustKeyposition(o+t.terz),i=Harmony.functions.adjustKeyposition(o+t.quinte);if("dur"===a)var a=Harmony.functions.adjustKeyposition(o+t.septime_dur);else var a=Harmony.functions.adjustKeyposition(o+t.septime);return{grund:Harmony.functions.getToneByKeyindex(o),terz:Harmony.functions.getToneByKeyindex(r),quinte:Harmony.functions.getToneByKeyindex(i),septime:Harmony.functions.getToneByKeyindex(a)}},getKlangDominant:function(e){var n=Harmony.functions.getToneByInterval(e,7),a=Harmony.functions.getKlang(n,"dur");return a},getKlangVerminderterDominant:function(e){var n=(Harmony.functions.getToneByInterval(e,-1),Harmony.functions.getKlang(dominant_grund,"ver"));return n},getScale:function(e){for(var n=["f-dur","d-moll","b-dur","g-moll","es-dur","c-moll","as-dur","f-moll","des-dur","b-moll","ges-dur","es-moll","ces-dur","as-moll"],a=0;n.length>a;a++)if(n[a]===e)return["c","des","d","es","e","f","ges","g","as","a","b","h"];return["c","cis","d","dis","e","f","fis","g","gis","a","ais","h"]},getToneByInterval:function(e,n){var a=Harmony.functions.getScale(info.currentTonart),t=Harmony.functions.adjustKeyposition(a.indexOf(e)+n);return a[t]},getToneByKeyindex:function(e){var n=Harmony.functions.getScale(info.currentTonart);return n[e]},getKeyindexByTone:function(e){for(var n=[{n:"c",v:0},{n:"cis",v:1},{n:"des",v:1},{n:"d",v:2},{n:"dis",v:3},{n:"es",v:3},{n:"e",v:4},{n:"f",v:5},{n:"fis",v:6},{n:"ges",v:6},{n:"g",v:7},{n:"gis",v:8},{n:"as",v:8},{n:"a",v:9},{n:"b",v:10},{n:"ais",v:10},{n:"h",v:11},{n:"ces",v:11}],a=0;n.length>a;a++)if(n[a].n===e)return n[a].v;return!1},adjustKeyposition:function(e){return e>11?e-12:e}},rules:{dreiklang:{dur:{grund:0,terz:4,quinte:7,septime:10,septime_dur:11},moll:{grund:0,terz:3,quinte:7,septime:10,septime_dur:11},ver:{grund:0,terz:3,quinte:6,septime:9},ueber:{grund:0,terz:4,quinte:8,septime:10}},harmonyset:{dur:[{name:"tonika",nameShort:"T",tonality:"dur",septime:"dur",interval:0},{name:"sub-dominant",nameShort:"S",tonality:"dur",interval:5},{name:"sub-dominant-parallele",nameShort:"Sp",tonality:"moll",interval:2},{name:"tonika-parallele",nameShort:"Tp",tonality:"moll",interval:9},{name:"dominant",nameShort:"D",tonality:"dur",interval:7},{name:"dominant-parallele",nameShort:"Dp",tonality:"moll",interval:4},{name:"vermindert-dominant",nameShort:"D-",tonality:"ver",interval:11}],moll:[{name:"tonika",nameShort:"t",tonality:"moll",septime:"dur",interval:0},{name:"sub-dominant",nameShort:"s",tonality:"moll",interval:5},{name:"sub-dominant-parallele",nameShort:"sP",tonality:"dur",interval:9},{name:"tonika-parallele",nameShort:"tP",tonality:"dur",interval:4},{name:"dominant",nameShort:"D",tonality:"dur",interval:7},{name:"dominant-parallele",nameShort:"dP",tonality:"dur",interval:11},{name:"mollsubdominantischer-sextakkord",nameShort:"s⁶",tonality:"ver",interval:2}]}}};
